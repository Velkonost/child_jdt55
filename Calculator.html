<!DOCTYPE html>
<html> 
	<head> 
	<script src="https://code.jquery.com/jquery.min.js"></script>
	 <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
	<script src="calculator.js"></script>
	<script src="tarifs_for_calculator.js"></script>
	<script src="metrika.js"></script> 
	<link href="octicons.css" rel="stylesheet">
	<link href="style_for_calculator_klim.css" rel="stylesheet">

	 <!-- Для сайта -->
	<script src="/sites/jdt55/files/users/Calc_files/calculator.js.txt"></script>
	<script src="/sites/jdt55/files/users/Calc_files/metrika.js.txt"></script> 
	<script src="/sites/jdt55/files/users/Calc_files/tarifs_for_calculator.js.txt"></script>
	<link href="/sites/jdt55/files/users/Calc_files/octicons.css" rel="stylesheet">
	<link href="/sites/jdt55/files/users/Calc_files/style_for_calculator_klim.css" rel="stylesheet">
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
	<script type="text/javascript">
		var Params;
	</script>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<title>Калькулятор грузоперевозок</title> 
	</head> 
<body> 
<div class="layer1" align="left">
		<h2 style="margin-top: 15px; margin-bottom: 3px;">Цены на доставку груза</h2>
			<p class="tarif"><a href="/sites/jdt55/files/users/admin1/prais-list_no1_zhd_perevozki.doc"><span style="color: rgb(102, 153, 102);">ЖД доставка сборных грузов</span></a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no2_avtoperevozki.xls"><span style="color: rgb(102, 153, 102);">Автоперевозка сборных грузов</span></a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no4_avtoekspedirovanie_po_moskve_i_oblasti.doc">Автоэкспедирование грузов по г.Москва</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prais-list_no3_avtoekspedirovanie_po_omsku.doc">Автоэкспедирование грузов по г.Омску</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no5_dop.upakovku_gruzov_v_g.moskva_0.doc"><span style="color: rgb(102, 153, 102);">Дополнительная упаковка грузов в г.Москва</span></a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_spb-omsk-spb.xls">Автоперевозка грузов Санкт-Петербург-Омск</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no6_avtoekspedirovanie_po_novosibirsku.xls">Автоэкспедирование грузов по г. Новосибирск</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_avto-_refrizherator_iz_moskvy_v_omsk.doc">Перевозка автомобилем-рефрижератором в г.Омск</a><span style="color:#ff0000;">&nbsp;</span></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/%D0%BF%D1%80%D0%B0%D0%B9%D1%81%20%D0%BD%D1%81%D0%BA-%D0%BE%D0%BC%D1%81%D0%BA.xls"> Автоперевозка сборных грузов из г.Новосибирска</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_iz_omska_i_pavlodara_3.xls">Из Омска в Казахстан и из Павлодара в Россию</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_iz_msk_nvs_v_kazahstan_3.xls">Из Москвы, Новосибирска в Казахстан</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_iz_spb_v_kazahstan_3.xls">Из Санкт-Петербурга в Казахстан</a></p><br>
			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_iz_ekb_i_tyumeni.xls">Из Екатеринбурга и Тюмени в Казахстан</a></p><br>
			<p>&nbsp;</p>		
</div>
<div class="calc">
	<form name="calc" id="calc"> 
		<h2 style="margin-left:-15px; ">Предварительный расчет</h2>
		<div class="form-group" style="margin-bottom: 0px;">
			<div align="left" class="selector">
				<select name="artkli-from" id="artkli-from" class="form-control" style="padding-left: 10px;">	
				</select>
			</div>
			<div align="left" class="selector" id="artkli-where">
				<select name="artkli-where" id="artkli-where_select" class="form-control">	
				</select>
			</div>
			<button type="button" class="btn btn-default" id="butt" data-toggle="tooltip" data-placement="top" title="Сброс" onclick="this.blur();"><span class="octicon octicon-x"></span>
			</button>
		</div>
				<div class="form-group" style="margin-bottom: 0px; padding-bottom: 0px;">
					<div id="artkli-chooser" align="left" style="margin-right: 10px; margin-bottom: 0px; padding-bottom: 0px;"></div>
					<div id="artkli-choose_way" align="left" style="margin-bottom: 0px; padding-bottom: 0px;" ></div>
					<br/>
				</div>
				<div class="form-group">
					<label for="artkli-massa" class="col-sm-2 control-label" style="width: 62px; margin-left: -14px; text-align: left; margin-bottom: 0px; margin-top: 5px;">Вес</label>
					<div class="col-sm-10" style="width: 200px;margin-bottom: 0px;padding-right: 0px;margin-right:0px; ">
						<input id="artkli-massa" name= "artkli-massa" class="form-control" type="text" placeholder = "Кг" style="text-align: right;" value="" onchange="window['yaCounter'+artkli_yandex_metrika_id].reachGoal('city_from'); return true;" oninput=""/>
					</div>
				</div>
				<div class="form-group">
					<label for="artkli-volume" class="col-sm-2 control-label" style=" width: 62px; margin-left: -14px;text-align: left; margin-top: 5px;">Объем</label>
					<div>
					<div class="col-sm-10" style="width: 200px;">
						<input id="artkli-volume" name= "artkli-volume" class="form-control" type="text" placeholder = "Куб.м." style="text-align: right;" value="" oninput=""/>
					</div>
					</div>
				</div>
					<div name="result_field" id="result_field" class="alert alert-info" style="height: 36px width: 100%; margin-right: 76px; margin-left: -15px;" role="alert"><font size="3"><span style="margin-bottom: 180px" id = "artkli-result">Итог</span></font></div>		
<table border="0" class="dump-noborder form-group" id="call" style="font-size: 12px; padding-left:12px; margin-left: -14px;">	
	<tbody>
		<tr>
			<td style="width: 22px;height: 16px; padding-bottom: 10px; ">
				<span class="octicon octicon-device-mobile" style="margin-left: 2px;vertical-align: bottom;"></span></td>
			<td style="padding-bottom: 6px;"> 
				<span style="text-align: justify;padding-bottom: 3px;">Позвонить: &nbsp; (3812) 45-04-39,&nbsp;&nbsp;8-913-967-98-98.</span></td>
		</tr>
		<tr>
			<td style="padding-bottom: 10px;">
				<span class="octicon octicon-mail-read" style="vertical-align: bottom;"></span></td>
			<td style="padding-bottom: 6px;">
				<span style="text-align: justify;">Написать: <a href="mailto:office@jdt55.ru" onclick="console.log(123)">office@jdt55.ru</a>.</span></td>
		</tr>
		<tr>
			<td style="padding-bottom: 10px;">
				<span class="octicon octicon-globe" style="vertical-align: bottom;"></span></td>
			<td style="padding-bottom: 6px;"> 
				<span style="text-align: justify;"><a target="_blank" href="/contact" onclick="window['yaCounter'+artkli_yandex_metrika_id].reachGoal('test'); return true;">Оставить заявку на сайте.</a></span></td>
		</tr>
	</tbody>
</table>
	</form>
	<div class="layer2" id="tarifs_links">
		<h2>Цены на доставку груза</h2>
			<p class="tarif" ><a href="/sites/jdt55/files/users/admin1/prais-list_no1_zhd_perevozki.doc"><span style="color: rgb(102, 153, 102);">ЖД доставка сборных грузов</span></a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no2_avtoperevozki.xls"><span style="color: rgb(102, 153, 102);">Автоперевозка сборных грузов</span></a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no4_avtoekspedirovanie_po_moskve_i_oblasti.doc">Автоэкспедирование грузов по г.Москва</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no3_avtoekspedirovanie_po_omsku.doc">Автоэкспедирование грузов по г.Омску</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no5_dop.upakovku_gruzov_v_g.moskva_0.doc"><span style="color: rgb(102, 153, 102);">Дополнительная упаковка грузов в г.Москва</span></a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_spb-omsk-spb.xls">Автоперевозка грузов Санкт-Петербург-Омск</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_no6_avtoekspedirovanie_po_novosibirsku.xls">Автоэкспедирование грузов по г. Новосибирск</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays-list_avto-_refrizherator_iz_moskvy_v_omsk.doc">Перевозка автомобилем-рефрижератором в г.Омск</a><span style="color:#ff0000;">&nbsp;</span></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/%D0%BF%D1%80%D0%B0%D0%B9%D1%81%20%D0%BD%D1%81%D0%BA-%D0%BE%D0%BC%D1%81%D0%BA.xls"> Автоперевозка сборных грузов из г.Новосибирска</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_iz_omska_i_pavlodara_3.xls">Из Омска в Казахстан и из Павлодара в Россию</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_iz_msk_nvs_v_kazahstan_3.xls">Из Москвы, Новосибирска в Казахстан</a></p><br>

			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_iz_spb_v_kazahstan_3.xls">Из Санкт-Петербурга в Казахстан</a></p><br>
			<p class="tarif" ><a href="/sites/jdt55/files/users/admin3/prays_iz_ekb_i_tyumeni.xls">Из Екатеринбурга и Тюмени в Казахстан</a></p><br>
			<p>&nbsp;</p>
	</div>
		<div class="artkli-footer" align="left" style="margin-left: -14px; margin-top: 50px;">
		<p style="font-size: 11px">	Калькулятор разработан при поддержке <a target="_blank" href="http://www.progschool.ru"><img src="http://www.progschool.ru/favicon.ico" style="vertical-align:-3px;width:16px;height:16px;margin-right:1px" onclick="window['yaCounter'+artkli_yandex_metrika_id].reachGoal('pars', params(Params)); return true;">Школы программиста</a>.</p>
		<p style="font-size: 11px">	Наставник: <a target="_blank" href="http://chivorotkiv.livejournal.com/">Сергей Шмаков</a></p>
	</div>
</div>
</div>
</body>
	<script>
(function() {
	$(document).ready(function(){ // Добавляет элемент
		$('[data-toggle="tooltip"]').tooltip();   
	});
	var result_field = $('#result_field')[0];

	function handle_from_changed(event){
		check_radio();
		update_where();
		update_from();
		fill_text();
	}
	function handle_where_changed(event){
		check_radio();
		update_from();
		update_where();
		fill_text();
	}
	function handle_reset_changed(event){
		reset();
	}
	function handle_massa_and_volume_changed(event){
		if(this.value != 0 && this.value != '.'){
			this.value = parseFloat(this.value)  || (this.value == '.' || this.value == '0') ? this.value : ''; 
			fill_text()
		}
	}
	function handle_radio_changed(event){
		fill_text();
	}
	function init_event_handlers(){
		var from = $('#artkli-from')[0];
		var where = $('#artkli-where_select')[0];
		var button = $('#butt')[0];
		var massa = $('#artkli-massa')[0];
		var volume = $('#artkli-volume')[0];

		from.addEventListener('change', handle_from_changed);
		where.addEventListener('change', handle_where_changed);
		button.addEventListener('click', handle_reset_changed);
		massa.addEventListener('input', handle_massa_and_volume_changed);
		volume.addEventListener('input', handle_massa_and_volume_changed);
	}
	var radioListener = 0;
	function update_way_dependent(tarifs, from, to) { // Меняет состояние элементов
		var chooser_dep = $('#artkli-chooser')[0];
		var dependency = $('#artkli-choose_way')[0];
		var buttons = [];
		var chooser = artkli_calculator.build_radio_chooser();
		if(!tarifs || to == "undefined_city" || from == "undefined_city"){
			dependency.setAttribute('class', 'artkli-hidden');
			chooser_dep.setAttribute('class', 'artkli-hidden'); 
		}
		else{
			var ways = Object.keys(artkli_tarifs[from][to]);
			for(var i = 0; i < ways.length; i++){
				var radio_name = ways[i];
				var radio = artkli_calculator.build_radio(radio_name, artkli_way_names[radio_name], i+1);
				buttons.push(radio);
			}
			var buttons = buttons.join("\n");
			chooser_dep.innerHTML = chooser;
			dependency.innerHTML = buttons;
			if($('#artkli-auto_way')[0]){
				var auto_way = $('#artkli-auto_way')[0];
				var jd_way = $('#artkli-jd_way')[0];
				auto_way.addEventListener('change', handle_radio_changed);
				jd_way.addEventListener('change', handle_radio_changed);
				console.log("add");
			}
			/*else{
				var auto_way = $('#artkli-auto_way')[0];
				auto_way.removeEventListener('change', handle_radio_changed);
				var jd_way = $('#artkli-jd_way')[0];
				jd_way.removeEventListener('change', handle_radio_changed);
				console.log("remove");
			}*/
			
			if(Object.keys(artkli_tarifs[from][to]).length == 2){
				dependency.setAttribute('class', ''); 
				chooser_dep.setAttribute('class', ''); 
			}
			else{
				dependency.setAttribute('class', 'artkli-hidden'); 
				chooser_dep.setAttribute('class', 'artkli-hidden'); 
			}
		}
	} 
	function get_tarifs(){return artkli_tarifs;} // Глобальная переменная

	function update_from(){// Зависит от грязной, изменяет элементы
		var from_elem = $("[name = 'artkli-from']")[0]; 
		var where = $("[name = 'artkli-where']")[0].value;

		artkli_calculator.update_from_selector(artkli_tarifs, artkli_city_names, from_elem, where);//Здесь
	}
	function update_where(){
		var where_elem = $("[name = 'artkli-where']")[0];
		var from = $("[name = 'artkli-from']")[0].value; 

		artkli_calculator.update_where_selector(artkli_tarifs, artkli_city_names, from, where_elem);
	}
	
	function check_radio(){//Зависит от грязной
		var from = $("[name = 'artkli-from']")[0].value; 
		var where = $("[name = 'artkli-where']")[0].value;
		update_way_dependent(artkli_tarifs, from, where); //Здесь
	}
	function init_build_selectors(way_cities){
		var options = [];
		var f_option = artkli_calculator.build_first_option();
		options.push(f_option);
		for(var i = 0; i < way_cities.length; i++){
			var city = way_cities[i];
				var option = artkli_calculator.build_option_html(city, artkli_city_names[city]);
				options.push(option);		
		}
		return options.join("\n");
	}
	function reset(){//Зависит от грязной		
		update_way_dependent(); //Здесь

		var from = $("[name = 'artkli-from']")[0].value; 
		var where = $("[name = 'artkli-where']")[0].value;
		var mass = $("[name = 'artkli-massa']")[0].value = "";
		var volume = $("[name = 'artkli-volume']")[0].value = ""; 

		var call = $('#call')[0];
		call.setAttribute('class', 'artkli-hidden');

		result_field.setAttribute('class','alert alert-info');

		var resultat = "Итог";
		$('#artkli-result')[0].innerHTML = resultat;

		var from_cities = artkli_calculator.get_from_cities_keys(artkli_tarifs, artkli_city_names);//Здесь
		var where_cities = artkli_calculator.get_where_cities(artkli_tarifs, artkli_city_names);
		from_cities.sort(function(a, b){
			return a < b ? -1 : a > b ? 1 : 0;
		});

		var from_select = $('#artkli-from')[0];
		var where_select = $('#artkli-where_select')[0];

		var options_html = init_build_selectors(from_cities);
		from_select.innerHTML = options_html;
		
		var options_html = init_build_selectors(where_cities);
		where_select.innerHTML = options_html;
	}
	function initialization(){//Зависит от грязной
		reset();//Здесь
		init_event_handlers();
		
		var call = $('#call')[0];
		call.setAttribute('class', 'artkli-hidden');

		update_way_dependent(); //Здесь

		var from_cities = artkli_calculator.get_from_cities_keys(artkli_tarifs, artkli_city_names);//Здесь
		var where_cities = artkli_calculator.get_where_cities(artkli_tarifs, artkli_city_names);
		
		from_cities.sort(function(a, b){
			return a < b ? -1 : a > b ? 1 : 0;
		});

		var options_html = init_build_selectors(from_cities);	
		var from_select = $('#artkli-from')[0];
		from_select.innerHTML = options_html;
		
		var options_html = init_build_selectors(where_cities)
		var where_select = $('#artkli-where_select')[0];
		where_select.innerHTML = options_html;
	}
	var resultat;
	function fill_text(){ //Зависит от грязной, изменяет кучу всего

		var from = $("[name = 'artkli-from']")[0].value;
		var where = $("[name = 'artkli-where']")[0].value;
		var mass = $("[name = 'artkli-massa']")[0];
		var volume = $("[name = 'artkli-volume']")[0];
		var check_auto = from + where;
		var tarifs = get_tarifs();//Здесь

		var way = $("[name = 'artkli-way']");
		var way = artkli_calculator.what_is_way(way);
			if(from == "undefined_city" && where == "undefined_city" && mass.value == 0 && volume.value == 0){
				resultat = "Итог";
				result_field.setAttribute('class','alert alert-info');
			}
			else if(from == "undefined_city" ){
				resultat = "Выберите пункт отправления!";
				result_field.setAttribute('class','alert alert-warning');

			}
			else if(where == "undefined_city" ){
				resultat = "Выберите пункт назначения!";
				result_field.setAttribute('class','alert alert-warning');
			}
			else if(mass.value == 0 ){					
				resultat = "Введите вес груза!";
				result_field.setAttribute('class','alert alert-warning');
				var call = $('#call')[0];
				call.setAttribute('class', 'artkli-hidden');
			}
			else if(volume.value == 0 ){
				resultat = "Введите объем груза!";
				result_field.setAttribute('class','alert alert-warning');
				var call = $('#call')[0];
				call.setAttribute('class', 'artkli-hidden');
			}
			else{
					var tax = artkli_calculator.conclusion_tax(artkli_tarifs, from, where, mass.value, volume.value, way);//?
					var tax_by_mass = tax.by_mass;
					var tax_by_volume = tax.by_volume;

					var ans1 = tax_by_mass * mass.value;
					var ans2 = tax_by_volume * volume.value;

					if(ans1 > ans2){
						resultat = ans1;
					}
					else{
						resultat = ans2;
					}
					if(artkli_calculator.auto_way_check(from, where, artkli_auto_way_tarifs)){
						if( mass.value > 5000 || volume.value >  25){
							resultat = "Цена договорная";
							result_field.setAttribute('class','alert alert-success');
						}
						else{
						resultat = artkli_calculator.digit(String(Math.round(resultat)));
						result_field.setAttribute('class','alert alert-success');
						var call = $('#call')[0];
						call.setAttribute('class', 'dump-noborder');
						resultat = "Автоперевозка! Итоговая сумма: "+resultat+" руб."; 
						}
					}
					else if(isNaN(resultat)){
						resultat = " ";
					}
					else if(tax_by_volume == -2 || tax_by_mass == -2){
						resultat = "Цена договорная";
						result_field.setAttribute('class','alert alert-success');
					}
					else{
						resultat = artkli_calculator.digit(String(Math.round(resultat)));
						result_field.setAttribute('class','alert alert-success');
						var call = $('#call')[0];
						call.setAttribute('class', 'dump-noborder');
						resultat = "Итоговая сумма: "+ resultat +" руб.";
					}
				}
			$('#artkli-result')[0].innerHTML = resultat;
	}
	Params = {itog: resultat};
	initialization();//Грязь?
})();

	</script>


	<!-- Yandex.Metrika counter -->
<script type="text/javascript">
	(function (d, w, c) {
		(w[c] = w[c] || []).push(function() {
			try {
				w['yaCounter' + artkli_yandex_metrika_id] = new Ya.Metrika({
					id:artkli_yandex_metrika_id,
					clickmap:true,
					trackLinks:true,
					accurateTrackBounce:true,
					webvisor:true
				});
			} catch(e) { }
		});

		var n = d.getElementsByTagName("script")[0],
			s = d.createElement("script"),
			f = function () { n.parentNode.insertBefore(s, n); };
		s.type = "text/javascript";
		s.async = true;
		s.src = "https://mc.yandex.ru/metrika/watch.js";

		if (w.opera == "[object Opera]") {
			d.addEventListener("DOMContentLoaded", f, false);
		} else { f(); }
	})(document, window, "yandex_metrika_callbacks");
</script>
<!-- /Yandex.Metrika counter -->
</body>
</html>






